(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29e1cf69"],{1276:function(t,e,i){"use strict";var s=i("d784"),n=i("44e7"),a=i("825a"),o=i("1d80"),r=i("4840"),c=i("8aa5"),l=i("50c4"),d=i("14c3"),u=i("9263"),f=i("9f7f"),h=f.UNSUPPORTED_Y,p=[].push,g=Math.min,v=4294967295;s("split",2,(function(t,e,i){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,i){var s=String(o(this)),a=void 0===i?v:i>>>0;if(0===a)return[];if(void 0===t)return[s];if(!n(t))return e.call(s,t,a);var r,c,l,d=[],f=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),h=0,g=new RegExp(t.source,f+"g");while(r=u.call(g,s)){if(c=g.lastIndex,c>h&&(d.push(s.slice(h,r.index)),r.length>1&&r.index<s.length&&p.apply(d,r.slice(1)),l=r[0].length,h=c,d.length>=a))break;g.lastIndex===r.index&&g.lastIndex++}return h===s.length?!l&&g.test("")||d.push(""):d.push(s.slice(h)),d.length>a?d.slice(0,a):d}:"0".split(void 0,0).length?function(t,i){return void 0===t&&0===i?[]:e.call(this,t,i)}:e,[function(e,i){var n=o(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,n,i):s.call(String(n),e,i)},function(t,n){var o=i(s,t,this,n,s!==e);if(o.done)return o.value;var u=a(t),f=String(this),p=r(u,RegExp),m=u.unicode,b=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(h?"g":"y"),_=new p(h?"^(?:"+u.source+")":u,b),C=void 0===n?v:n>>>0;if(0===C)return[];if(0===f.length)return null===d(_,f)?[f]:[];var w=0,k=0,x=[];while(k<f.length){_.lastIndex=h?0:k;var D,I=d(_,h?f.slice(k):f);if(null===I||(D=g(l(_.lastIndex+(h?k:0)),f.length))===w)k=c(f,k,m);else{if(x.push(f.slice(w,k)),x.length===C)return x;for(var P=1;P<=I.length-1;P++)if(x.push(I[P]),x.length===C)return x;k=w=D}}return x.push(f.slice(w)),x}]}),h)},"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"841c":function(t,e,i){"use strict";var s=i("d784"),n=i("825a"),a=i("1d80"),o=i("129f"),r=i("14c3");s("search",1,(function(t,e,i){return[function(e){var i=a(this),s=void 0==e?void 0:e[t];return void 0!==s?s.call(e,i):new RegExp(e)[t](String(i))},function(t){var s=i(e,t,this);if(s.done)return s.value;var a=n(t),c=String(this),l=a.lastIndex;o(l,0)||(a.lastIndex=0);var d=r(a,c);return o(a.lastIndex,l)||(a.lastIndex=l),null===d?-1:d.index}]}))},e2b5:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"agreement-organisation"},[t.success?[t._m(0)]:[i("div",{staticClass:"h3"},[t._v("Добрый день, "),i("br"),t._v(t._s(t.person?t.person.name:"")+"!")]),i("p",[t._v("Для организаций "+t._s(t.person?t.person.company.name:"")+" оформлена кредитная программа. Для оформление заявки, необходимо ваше согласование, как одного из учредителей.")]),i("a",{staticClass:"link link-with-loading",class:{loading:t.downloadLoading},attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.downloadFile.apply(null,arguments)}}},[t._v("Подробнее о кредитной программе")]),i("button",{staticClass:"btn btn-block btn-lg",class:{loading:t.load},attrs:{disabled:t.load},on:{click:t.initDiadocScript}},[t._v("Подписать")]),i("div",{staticClass:"footer-text"},[t._v("Подписание осуществляется при помощи ЭП")])],t.diadocModal?i("Popup",{ref:"diadocModal",attrs:{classes:"diadoc-plugins-modal"},on:{"close-modal":function(t){this.diadocModal=!1}}},[i("div",{staticClass:"popup-title"},[i("div",{staticClass:"h2"},[t._v("Для подписания документов при помощи ЭЦП Вам необходимо:")])]),i("div",{staticClass:"popup-body"},[i("div",{staticClass:"plugins-list"},[i("div",{staticClass:"plugins-list-item"},[t._v("1. Установить криптопровайдер: "),i("br"),i("a",{staticClass:"link",attrs:{href:"https://www.cryptopro.ru/products/cades/plugin",target:"_blank"}},[t._v("КриптоПро CSP")])]),i("div",{staticClass:"plugins-list-item"},[t._v("2. Установите КриптоПро ЭЦП Browser plug-in: "),i("br"),i("a",{staticClass:"link",attrs:{href:"https://cryptopro.ru/products/cades/plugin/get_2_0",target:"_blank"}},[t._v("КриптоПро CSP Browser plug-in")])])])])]):t._e(),t.sertificatesModal?i("Popup",{ref:"sertificatesModal",attrs:{classes:"sertificates-modal"},on:{"close-modal":function(e){t.sertificatesModal=!1}}},[i("div",{staticClass:"popup-title"},[i("div",{staticClass:"h2"},[t._v("Выберите необходимый сертификат для цифровой подписи документов:")])]),i("div",{staticClass:"popup-body"},[i("div",{staticClass:"select-sertificates"},t._l(t.sertificates,(function(e){return i("div",{key:e._cadesCertificate.objid,staticClass:"sertificates-item",class:{active:t.selectedSertificates==e},on:{click:function(i){t.selectedSertificates=e}}},[i("span",[t._v(t._s(e.name)+" (действителен до: "+t._s(t.parseDate(e.validTo))+")")])])})),0),i("button",{staticClass:"btn btn-block",class:{loading:t.signLoad},attrs:{disabled:t.signLoad},on:{click:t.createSignature}},[t._v("Подписать")])])]):t._e(),t.errorDiadocModal?i("Popup",{attrs:{error:!0,classes:"error-modal",zIndex:101},on:{"close-modal":function(e){t.errorDiadocModal=!1}}},[i("div",{staticClass:"popup-title"},[i("div",{staticClass:"h3"},[t._v("Ошибка")])]),i("div",{staticClass:"popup-body"},[i("p",{staticClass:"error-text"},[t._v(t._s(t.errorDiadocText))]),i("button",{staticClass:"btn btn-lg btn-block close-modal"},[t._v("Попробовать снова")])])]):t._e()],2)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"agreement-result"},[i("div",{staticClass:"agreement-result-icon"},[i("span",{staticClass:"icon-double-checkmark"})]),i("div",{staticClass:"h3"},[t._v("Успешно!")])])}],a=i("5530"),o=(i("159b"),i("d3b7"),i("3ca3"),i("ddb0"),i("b0c0"),i("ac1f"),i("1276"),i("5319"),i("841c"),i("fb07")),r=i("c1df"),c=i.n(r),l=i("2f62"),d=i("8acc"),u={name:"AgreementOrganisitionMain",components:{Popup:d["a"]},data:function(){return{load:!1,signLoad:!1,sertificates:[],selectedSertificates:"",sertificatesModal:!1,diadocModal:!1,downloadLoading:!1,success:!1,orderId:"",errorDiadocModal:!1}},computed:Object(a["a"])({},Object(l["b"])({person:function(t){return t.agreement.personFinish},finalDocsList:function(t){return t.agreement.docs}})),methods:{parseDate:function(t){return c()(t).format("DD.MM.YYYY")},initDiadocScript:function(){var t=this;this.load||(this.load=!0,Object(o["getSystemInfo"])().then((function(e){t.load=!1,Object(o["getUserCertificates"])().then((function(e){if(e.length>0){var i=[];t.sertificates=[],e.forEach((function(e){i.push(new Promise((function(i){e.isValid().then((function(){t.sertificates.push(e),i()}))})))})),Promise.all(i).then((function(){t.load=!1,t.selectedSertificates=t.sertificates[0],t.sertificatesModal=!0}))}})).catch((function(e){switch(e){case"certificates_not_found":t.errorDiadocText="Не найдено ни одного сертификата.";break;case"valid_certificates_not_found":t.errorDiadocText="Не найдено ни одного валидного сертификата.";break;case"certificate_read_error":t.errorDiadocText="Ошибка чтения одного из сертификатов.";break}t.errorDiadocModal=!0}))})).catch((function(e){t.load=!1,t.diadocModal=!0})))},readFile:function(t){return new Promise((function(e){var i=new FileReader;i.onload=function(){e(this.result)},i.readAsArrayBuffer(t)}))},generateSignature:function(t){var e,i=this,s=this.selectedSertificates;return new Promise((function(n,a){e=Object(o["createAttachedSignature"])(s.thumbprint,t),e.then((function(t){n(t)}),(function(t){this.errorDiadocText=t.message,this.errorDiadocModal=!0,this.signLoad=!1,a()})).catch((function(t){i.errorDiadocText=t.message,i.errorDiadocModal=!0,i.signLoad=!1}))}))},createSignature:function(){var t=this;this.signLoad=!0;var e=this,i=[],s={orderId:this.orderId,token:this.getParametr,docs:[]};this.finalDocsList.forEach((function(n){var a={docId:n.id,files:[]};n.files.forEach((function(s){i.push(new Promise((function(i,n){t.$store.dispatch("getFileWithoutToken",{token:t.getParametr,fileId:s.id}).then((function(r){var c=new File([r],s.name,{type:s.format}),l=t.readFile(c);l.then((function(t){Object(o["createHash"])(t).then((function(){var n=this;e.generateSignature(t).then((function(t){a.files.push({id:s.id,signature:t}),i()})).catch((function(){n.signLoad=!1}))}),(function(t){this.errorDiadocText=t.message,this.errorDiadocModal=!0,this.signLoad=!1,n()}))}))}))})))})),s.docs.push(a)})),Promise.all(i).then((function(){t.$store.dispatch("sendSignatureForFoundersFinish",s).then((function(){t.signLoad=!1,t.$refs.sertificatesModal.closePopup(),t.successModal=!0,t.success=!0}))})).catch((function(){return t.signLoad=!1}))},downloadFile:function(){var t=this;if(!this.downloadLoading){this.downloadLoading=!0;var e=[];this.finalDocsList.forEach((function(i){i.files.forEach((function(i){e.push(new Promise((function(e){t.$store.dispatch("getFileWithoutToken",{token:t.getParametr,fileId:i.id}).then((function(s){t.$store.dispatch("downloadFile",{content:s,name:i.name,format:i.format}).then(e)}))})))}))})),Promise.all(e).then((function(){t.downloadLoading=!1}))}}},mounted:function(){var t=window.location.search.replace("?","").split("&").reduce((function(t,e){var i=e.split("=");return t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]),t}),{});this.getParametr=t["c"],this.orderId=t["id"],this.$store.dispatch("getPersonDataFinish",{token:this.getParametr,orderId:this.orderId}),this.$store.dispatch("getAgreementDocsFinish",{token:this.getParametr,orderId:this.orderId})}},f=u,h=i("2877"),p=Object(h["a"])(f,s,n,!1,null,"07f23780",null);e["default"]=p.exports}}]);
//# sourceMappingURL=chunk-29e1cf69.8253b9d4.js.map