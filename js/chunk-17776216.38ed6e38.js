(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17776216"],{1276:function(t,e,s){"use strict";var i=s("d784"),a=s("44e7"),o=s("825a"),n=s("1d80"),l=s("4840"),r=s("8aa5"),c=s("50c4"),d=s("14c3"),u=s("9263"),p=s("9f7f"),f=p.UNSUPPORTED_Y,v=[].push,h=Math.min,g=4294967295;i("split",2,(function(t,e,s){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,s){var i=String(n(this)),o=void 0===s?g:s>>>0;if(0===o)return[];if(void 0===t)return[i];if(!a(t))return e.call(i,t,o);var l,r,c,d=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,h=new RegExp(t.source,p+"g");while(l=u.call(h,i)){if(r=h.lastIndex,r>f&&(d.push(i.slice(f,l.index)),l.length>1&&l.index<i.length&&v.apply(d,l.slice(1)),c=l[0].length,f=r,d.length>=o))break;h.lastIndex===l.index&&h.lastIndex++}return f===i.length?!c&&h.test("")||d.push(""):d.push(i.slice(f)),d.length>o?d.slice(0,o):d}:"0".split(void 0,0).length?function(t,s){return void 0===t&&0===s?[]:e.call(this,t,s)}:e,[function(e,s){var a=n(this),o=void 0==e?void 0:e[t];return void 0!==o?o.call(e,a,s):i.call(String(a),e,s)},function(t,a){var n=s(i,t,this,a,i!==e);if(n.done)return n.value;var u=o(t),p=String(this),v=l(u,RegExp),m=u.unicode,_=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(f?"g":"y"),C=new v(f?"^(?:"+u.source+")":u,_),b=void 0===a?g:a>>>0;if(0===b)return[];if(0===p.length)return null===d(C,p)?[p]:[];var M=0,D=0,k=[];while(D<p.length){C.lastIndex=f?0:D;var w,P=d(C,f?p.slice(D):p);if(null===P||(w=h(c(C.lastIndex+(f?D:0)),p.length))===M)D=r(p,D,m);else{if(k.push(p.slice(M,D)),k.length===b)return k;for(var S=1;S<=P.length-1;S++)if(k.push(P[S]),k.length===b)return k;D=M=w}}return k.push(p.slice(M)),k}]}),f)},a15b:function(t,e,s){"use strict";var i=s("23e7"),a=s("44ad"),o=s("fc6a"),n=s("a640"),l=[].join,r=a!=Object,c=n("join",",");i({target:"Array",proto:!0,forced:r||!c},{join:function(t){return l.call(o(this),void 0===t?",":t)}})},b718:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"load-documents-container"},[s("div",{staticClass:"go-back-link"},[s("router-link",{attrs:{to:"/orders"}},[s("span",{staticClass:"icon-arrow-left"}),t._v("Назад")])],1),t._m(0),s("div",{staticClass:"block"},[t._m(1),s("div",{staticClass:"block-content"},[s("div",{staticClass:"upload-documents"},t._l(t.neededToLoadFiles,(function(e){return s("div",{key:e.id,staticClass:"upload-documents-item"},[s("div",{staticClass:"upload-documents-img"},[s("div",{staticClass:"upload-documents-poster"},[t._v(" "+t._s(0!==e.files.length?e.files[e.files.length-1].format:"File")+" ")])]),s("div",{staticClass:"upload-documents-title",class:{uploaded:0!==e.files.length}},[t._v(" "+t._s(e.name)+" "),0!==e.files.length?s("ul",{staticClass:"uploaded-files"},t._l(e.files,(function(e,i){return s("li",{key:e.id},[s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.openDocViewModal(e)}}},[t._v(t._s(i+1)+". "+t._s(e.name)+"."+t._s(e.format))])])})),0):t._e(),e.desc?s("p",{domProps:{innerHTML:t._s(e.desc)}}):t._e()]),s("div",{staticClass:"upload-documents-status"},[e.loaded?[s("div",{staticClass:"upload-documents-loaded"},[t._v("Загружается")])]:[0!==e.files.length?[s("div",{staticClass:"upload-success"},[s("div",{staticClass:"upload-success-text"},[t._v("Загружено")]),s("label",{staticClass:"upload-add-btn"},[s("input",{attrs:{type:"file",multiple:""},on:{change:function(s){return t.selectedFile(s,e)}}}),s("span",{staticClass:"icon-doc-plus"})]),s("a",{staticClass:"upload-success-delete",attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.deleteFiles(e.id)}}},[s("span",{staticClass:"icon-trash"})])])]:[s("div",{staticClass:"upload-load"},[s("label",{staticClass:"upload-file-btn"},[s("input",{attrs:{type:"file",multiple:""},on:{change:function(s){return t.selectedFile(s,e)}}}),s("span",{staticClass:"btn btn-sm btn-border"},[t._v("Загрузить")])])])]]],2)])})),0),s("div",{staticClass:"not-loaded-documents-done"},[t._m(2),s("button",{staticClass:"btn",attrs:{disabled:!t.canSignature},on:{click:t.doneLoadFiles}},[t._v("Готово")])]),s("div",{staticClass:"loaded-documents"},[s("div",{staticClass:"h4"},[t._v("Загруженные ранее документы")]),s("div",{staticClass:"loaded-documents-list"},[t._l(t.documentsForSigning,(function(e){return[0!==e.files.length?s("div",{key:e.id,staticClass:"upload-documents-item"},[s("div",{staticClass:"upload-documents-img"},[s("div",{staticClass:"upload-documents-poster"},[t._v(" "+t._s(e.files[0].format)+" ")])]),s("div",{staticClass:"upload-documents-title"},[t._v(" "+t._s(e.name)+" "),s("ul",{staticClass:"uploaded-files"},t._l(e.files,(function(e,i){return s("li",{key:e.id},[s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.loadDocument(e)}}},[t._v(t._s(i+1)+"."+t._s(e.name)+"."+t._s(e.format))])])})),0)]),t._m(3,!0)]):t._e()]}))],2)])])]),t.orderUpdatedModal?s("Popup",{ref:"orderUpdatedModal",on:{"close-modal":t.closeUpdatedModal}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h3"},[t._v("Ваша заявка обновлена")])]),s("div",{staticClass:"popup-body"},[s("p",[t._v("Срок рассмотрения обычно занимает 8 часов. Вы можете отслеживать статус заявки в окне Ваши заявки на главной странице.")]),s("button",{staticClass:"btn btn-block btn-lg close-modal"},[t._v("Понятно")])])]):t._e(),t.viewDocumentModal?s("DocView",{attrs:{list:t.viewDocument,familiarizedBtn:!1},on:{"close-modal":function(e){return t.closeViewDocModal()}}}):t._e(),t.signingModal?s("Popup",{ref:"signingModal",on:{"close-modal":function(e){t.signingModal=!1}}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h2"},[t._v("Подписание загруженных документов")])]),s("div",{staticClass:"order-success"},[s("div",{staticClass:"order-success-submit"},[s("button",{staticClass:"btn btn-block btn-lg",class:{loading:t.load},attrs:{disabled:t.load},on:{click:t.initDiadocScript}},[t._v("Подписать ")]),s("p",[t._v("Подписание осуществляется при помощи ЭП")])])])]):t._e(),t.diadocModal?s("Popup",{ref:"diadocModal",attrs:{classes:"diadoc-plugins-modal"},on:{"close-modal":t.closeDiadocModal}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h2"},[t._v("Для подписания документов при помощи ЭЦП Вам необходимо:")])]),s("div",{staticClass:"popup-body"},[s("div",{staticClass:"plugins-list"},[s("div",{staticClass:"plugins-list-item"},[t._v("1. Установить криптопровайдер: "),s("br"),s("a",{staticClass:"link",attrs:{href:"https://www.cryptopro.ru/products/cades/plugin",target:"_blank"}},[t._v("КриптоПро CSP")])]),s("div",{staticClass:"plugins-list-item"},[t._v("2. Установите КриптоПро ЭЦП Browser plug-in: "),s("br"),s("a",{staticClass:"link",attrs:{href:"https://cryptopro.ru/products/cades/plugin/get_2_0",target:"_blank"}},[t._v("КриптоПро CSP Browser plug-in")])])])])]):t._e(),t.sertificatesModal?s("Popup",{ref:"sertificatesModal",attrs:{classes:"sertificates-modal"},on:{"close-modal":t.closeSertificatesModal}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h2"},[t._v("Выберите необходимый сертификат для цифровой подписи документов:")])]),s("div",{staticClass:"popup-body"},[s("div",{staticClass:"select-sertificates"},t._l(t.sertificates,(function(e){return s("div",{key:e._cadesCertificate.objid,staticClass:"sertificates-item",class:{active:t.selectedSertificates==e},on:{click:function(s){t.selectedSertificates=e}}},[s("span",[t._v(t._s(e.name)+" (действителен до: "+t._s(t.parseDate(e.validTo))+")")])])})),0),s("div",{staticClass:"sertificate-helper"},[s("p",[t._v(" * Если не видите необходимый сертификат, то возможно он не добавлен в программе КриптоПро. Чтобы добавить сертификат в КриптоПро следуйте следующей инструкции:"),s("br"),s("a",{staticClass:"download-link",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.instructionPopup=!0}}},[t._v("Инструкция по добавлению сертификата")])])]),s("button",{staticClass:"btn btn-block",class:{loading:t.signLoad},attrs:{disabled:t.signLoad},on:{click:t.createSignature}},[t._v("Подписать")])])]):t._e(),t.mobModal?s("Popup",{ref:"mobModal",attrs:{classes:"mob-modal"},on:{"close-modal":function(e){t.mobModal=!1}}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h2"},[t._v("Внимание!")])]),s("div",{staticClass:"popup-body"},[s("p",[t._v("Подписание при помощи ЭЦП невозможно с мобильного устройства. Пожалуйста, перейдите на десктопную версию и установите необходимые программы:")]),s("div",{staticClass:"plugins-list"},[s("div",{staticClass:"plugins-list-item"},[t._v("1. Криптопровайдер: "),s("br"),s("a",{staticClass:"link",attrs:{href:"https://www.cryptopro.ru/products/cades/plugin",target:"_blank"}},[t._v("КриптоПро CSP")])]),s("div",{staticClass:"plugins-list-item"},[t._v("2. КриптоПро ЭЦП Browser plug-in: "),s("br"),s("a",{staticClass:"link",attrs:{href:"https://cryptopro.ru/products/cades/plugin/get_2_0",target:"_blank"}},[t._v("КриптоПро CSP Browser plug-in")])])])])]):t._e(),t.errorDiadocModal?s("Popup",{attrs:{error:!0,classes:"error-modal",zIndex:101},on:{"close-modal":function(e){t.errorDiadocModal=!1}}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h3"},[t._v("Ошибка")])]),s("div",{staticClass:"popup-body"},[s("p",{staticClass:"error-text"},[t._v(t._s(t.errorDiadocText))]),s("button",{staticClass:"btn btn-lg btn-block close-modal"},[t._v("Попробовать снова")])])]):t._e(),t.instructionPopup?s("Popup",{ref:"instructionPopup",attrs:{classes:"instruction-modal"},on:{"close-modal":function(e){t.instructionPopup=!1}}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h2"},[t._v("Инструкция по добавлению сертификата")])]),s("div",{staticClass:"popup-body"},[s("ol",[s("li",[t._v("Вставьте цифровой носитель электронной подписи")]),s("li",[t._v("Откройте программу КриптоПро CSP на компьютере")]),s("li",[t._v('Нажмите на вкладку "Сервис"')]),s("li",[t._v('В окне выберите пункт "Просмотреть сертификаты в контейнере"')]),s("li",[t._v('В открывшемся окне нажмите на кнопку "Обзор". Выберите контейнер и подтвердите свой выбор кнопкой ОК')]),s("li",[t._v('В открывшемся окне нажмите на кнопку "Установить". После этого согласитесь с предложением заменить сертификат')]),s("li",[t._v("Обновите страницу в браузере")])]),s("p",[t._v("С более подробной инструкцией вы можете ознакомиться по "),s("a",{staticClass:"link",attrs:{href:"https://cryptostore.ru/article/instruktsii/kak_ustanovit_sertifikat_podpisi_cherez_kriptopro_csp/",target:"_blank"}},[t._v("ссылке")])])])]):t._e(),t.errorModal?s("Popup",{attrs:{error:!0,classes:"error-modal"},on:{"close-modal":function(e){t.errorModal=!1}}},[s("div",{staticClass:"popup-title"},[s("div",{staticClass:"h3"},[t._v("Ошибка при загрузке")])]),s("div",{staticClass:"popup-body"},[s("p",{staticClass:"error-text"},[t._v(t._s(t.errorText))]),s("button",{staticClass:"btn btn-lg btn-block close-modal"},[t._v("Хорошо")])])]):t._e()],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-title"},[s("h1",[t._v("Загрузить документы")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"block-title"},[s("div",{staticClass:"h3"},[t._v("Необходимые документы")]),s("p",[t._v("Загрузите необходимые документы по списку. Допустимые форматы: JPG, DOC, PDF, XLS.")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("Загрузите необходимые документы"),s("br"),t._v("чтобы продолжить ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"upload-documents-status"},[s("div",{staticClass:"upload-success"},[s("div",{staticClass:"upload-success-text"},[t._v("Загружено")])])])}],o=s("5530"),n=(s("159b"),s("a15b"),s("ac1f"),s("1276"),s("b0c0"),s("d3b7"),s("3ca3"),s("ddb0"),s("498a"),s("5319"),s("8acc")),l=s("2f2e"),r=s("2f62"),c=s("fb07"),d=s("c1df"),u=s.n(d),p={name:"load-documents",components:{DocView:l["a"],Popup:n["a"]},computed:Object(o["a"])(Object(o["a"])({},Object(r["c"])({company:function(t){return t.users.company},orderFullInfo:function(t){return t.createOrder.orderFullInfo},neededToLoadFiles:function(t){return t.createOrder.neededToLoadFiles},documentsForSigning:function(t){return t.createOrder.documentsForSigning}})),{},{canSignature:function(){var t=!0;return this.neededToLoadFiles.forEach((function(e){0===e.files.length&&(t=!1)})),t}}),data:function(){return{load:!1,orderUpdatedModal:!1,checkLoadedDocs:!1,loadedDocsViews:[],selectBranch:!1,signingModal:!1,diadocModal:!1,errorDiadocModal:!1,errorDiadocText:"",sertificatesModal:!1,mobModal:!1,signLoad:!1,sertificates:[],selectedSertificates:{},viewDocumentModal:!1,viewDocument:{},instructionPopup:!1,errorModal:!1,errorText:""}},methods:{selectedFile:function(t,e){var s=this;e.loaded=!0;var i=t.target.files;i.forEach((function(i){var a=i.name.split("").reverse().join("").split(".")[0].split("").reverse().join(""),o=i.size;return"jpg"!==a&&"png"!==a&&"doc"!==a&&"docx"!==a&&"pdf"!==a&&"xls"!==a&&"xlsx"!==a?(s.errorText="Допустимые форматы: JPG, PNG, DOC, DOCX, PDF, XLS, XLSX",s.errorModal=!0,e.loaded=!1,!1,t.target.value="",!1):o>3e6?(s.errorText="Размер файла не должен превышать 3 Мбайт",s.errorModal=!0,e.loaded=!1,!1,t.target.value="",!1):0===o?(s.errorText="Файл не допустимого размера (0 байт)",s.errorModal=!0,e.loaded=!1,!1,t.target.value="",!1):void 0})),this.$store.dispatch("sendFile",{files:t.target.files,id:e.id}).then((function(){e.loaded=!1}))},signingEvent:function(){var t=this;this.load=!0,setTimeout((function(){t.load=!1,t.$refs.signingModal.closePopup(),t.orderUpdatedModal=!0}),1e3)},doneLoadFiles:function(){this.canSignature&&(this.signingModal=!0)},closeSigningModal:function(){this.signingModal=!1},closeUpdatedModal:function(){this.orderUpdatedModal=!0,this.$router.push("/orders")},closeViewDocModal:function(){this.viewDocumentModal=!1},openDocViewModal:function(t){"pdf"===t.format||"jpg"===t.format||"png"===t.format?(this.viewDocument=t,this.viewDocumentModal=!0):this.docViewErrorModal=!0},deleteFiles:function(t){var e=this;this.$store.dispatch("deleteFiles",t).then((function(){e.$store.dispatch("getNeededToLoadFiles",e.$route.params.id)}))},initDiadocScript:function(){var t=this;this.load||(this.load=!0,Object(c["getSystemInfo"])().then((function(e){t.load=!1,Object(c["getUserCertificates"])().then((function(e){if(e.length>0){var s=[];t.sertificates=[],e.forEach((function(e){s.push(new Promise((function(s){e.isValid().then((function(){t.sertificates.push(e),s()}))})))})),Promise.all(s).then((function(){t.load=!1,t.$refs.signingModal.closePopup(),t.selectedSertificates=t.sertificates[0],t.sertificatesModal=!0}))}})).catch((function(e){switch(e){case"certificates_not_found":t.errorDiadocText="Не найдено ни одного сертификата.";break;case"valid_certificates_not_found":t.errorDiadocText="Не найдено ни одного валидного сертификата.";break;case"certificate_read_error":t.errorDiadocText="Ошибка чтения одного из сертификатов.";break}t.errorDiadocModal=!0}))})).catch((function(e){t.load=!1,t.diadocModal=!0,t.$refs.signingModal.closePopup()})))},readFile:function(t){return new Promise((function(e){var s=new FileReader;s.onload=function(){e(this.result)},s.readAsArrayBuffer(t)}))},generateSignature:function(t){var e,s=this.selectedSertificates,i=this;return new Promise((function(a,o){e=Object(c["createAttachedSignature"])(s.thumbprint,t),e.then((function(t){a(t)}),(function(t){i.errorDiadocText=t.message,i.errorDiadocModal=!0,i.signLoad=!1,o()}))}))},createSignature:function(){var t=this,e=this.selectedSertificates.name.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"").toLowerCase().trim(),s=this.company.name.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"").toLowerCase().trim();if(e!==s)return this.errorDiadocText="Вы выбрали сертификат, который не принадлежит компании",this.errorDiadocModal=!0,!1;this.signLoad=!0;var i=this,a=[],o=[];this.neededToLoadFiles.forEach((function(e,s){0!==e.files.length&&(o.push({id:e.id,docs:[]}),e.files.forEach((function(e){a.push(new Promise((function(a,n){t.$store.dispatch("getFile",e.id).then((function(l){var r=new File([l],e.name,{type:e.format}),d=t.readFile(r);d.then((function(t){Object(c["createHash"])(t).then((function(){i.generateSignature(t).then((function(t){o[s].docs.push({id:e.id,signature:t}),a()}))}),(function(t){this.errorDiadocText=t.message,this.errorDiadocModal=!0,n()}))}))}))})))})))})),Promise.all(a).then((function(){var e=[];o.forEach((function(s){e.push(new Promise((function(e){t.$store.dispatch("sendSignature",s).then((function(t){t&&e()}))})))})),Promise.all(e).then((function(){t.$store.dispatch("sendAdditionalDocs",t.$route.params.id).then((function(e){e?(t.signLoad=!1,t.$refs.sertificatesModal.closePopup(),t.successModal=!0,t.$router.push("/orders")):t.signLoad=!1}))})).catch((function(){return t.signLoad=!1}))}))},closeSuccessModal:function(){this.successModal=!1,this.$router.push("/orders")},closeDiadocModal:function(){this.diadocModal=!1},closeSertificatesModal:function(){this.sertificatesModal=!1},parseDate:function(t){return u()(t).format("DD.MM.YYYY")},loadDocument:function(t){var e=this;this.$store.dispatch("getFile",t.id).then((function(s){e.$store.dispatch("downloadFile",{content:s,name:t.name,format:t.format})}))}},mounted:function(){this.$store.dispatch("getCurrentOrder",this.$route.params.id),this.$store.dispatch("getNeededToLoadFiles",this.$route.params.id),this.$store.dispatch("getDocumentsForSigning",this.$route.params.id)}},f=p,v=s("2877"),h=Object(v["a"])(f,i,a,!1,null,"acf8b508",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-17776216.38ed6e38.js.map