(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2101f2"],{b718:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"load-documents-container"},[e("div",{staticClass:"go-back-link"},[e("router-link",{attrs:{to:"/orders"}},[e("span",{staticClass:"icon-arrow-left"}),t._v("Назад")])],1),t._m(0),e("div",{staticClass:"block"},[t._m(1),e("div",{staticClass:"block-content"},[e("div",{staticClass:"upload-documents"},t._l(t.neededToLoadFiles,(function(s){return e("div",{key:s.id,staticClass:"upload-documents-item"},[e("div",{staticClass:"upload-documents-img"},[e("div",{staticClass:"upload-documents-poster"},[t._v(" "+t._s(0!==s.files.length?s.files[s.files.length-1].format:"File")+" ")])]),e("div",{staticClass:"upload-documents-title",class:{uploaded:0!==s.files.length}},[t._v(" "+t._s(s.name)+" "),0!==s.files.length?e("ul",{staticClass:"uploaded-files"},t._l(s.files,(function(s,i){return e("li",{key:s.id},[e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openDocViewModal(s)}}},[t._v(t._s(i+1)+". "+t._s(s.name)+"."+t._s(s.format))])])})),0):t._e(),s.desc?e("p",{domProps:{innerHTML:t._s(s.desc)}}):t._e()]),e("div",{staticClass:"upload-documents-status"},[s.loaded?[e("div",{staticClass:"upload-documents-loaded"},[t._v("Загружается")])]:[0!==s.files.length?[e("div",{staticClass:"upload-success"},[e("div",{staticClass:"upload-success-text"},[t._v("Загружено")]),e("label",{staticClass:"upload-add-btn"},[e("input",{attrs:{type:"file",multiple:""},on:{change:function(e){return t.selectedFile(e,s)}}}),e("span",{staticClass:"icon-doc-plus"})]),e("a",{staticClass:"upload-success-delete",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.deleteFiles(s.id)}}},[e("span",{staticClass:"icon-trash"})])])]:[e("div",{staticClass:"upload-load"},[e("label",{staticClass:"upload-file-btn"},[e("input",{attrs:{type:"file",multiple:""},on:{change:function(e){return t.selectedFile(e,s)}}}),e("span",{staticClass:"btn btn-sm btn-border"},[t._v("Загрузить")])])])]]],2)])})),0),e("div",{staticClass:"not-loaded-documents-done"},[t._m(2),e("button",{staticClass:"btn",attrs:{disabled:!t.canSignature},on:{click:t.doneLoadFiles}},[t._v("Готово")])]),e("div",{staticClass:"loaded-documents"},[e("div",{staticClass:"h4"},[t._v("Загруженные ранее документы")]),e("div",{staticClass:"loaded-documents-list"},[t._l(t.documentsForSigning,(function(s){return[0!==s.files.length?e("div",{key:s.id,staticClass:"upload-documents-item"},[e("div",{staticClass:"upload-documents-img"},[e("div",{staticClass:"upload-documents-poster"},[t._v(" "+t._s(s.files[0].format)+" ")])]),e("div",{staticClass:"upload-documents-title"},[t._v(" "+t._s(s.name)+" "),e("ul",{staticClass:"uploaded-files"},t._l(s.files,(function(s,i){return e("li",{key:s.id},[e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.loadDocument(s)}}},[t._v(t._s(i+1)+"."+t._s(s.name)+"."+t._s(s.format))])])})),0)]),t._m(3,!0)]):t._e()]}))],2)])])]),t.orderUpdatedModal?e("Popup",{ref:"orderUpdatedModal",on:{"close-modal":t.closeUpdatedModal}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h3"},[t._v("Ваша заявка обновлена")])]),e("div",{staticClass:"popup-body"},[e("p",[t._v("Срок рассмотрения обычно занимает 8 часов. Вы можете отслеживать статус заявки в окне Ваши заявки на главной странице.")]),e("button",{staticClass:"btn btn-block btn-lg close-modal"},[t._v("Понятно")])])]):t._e(),t.viewDocumentModal?e("DocView",{attrs:{list:t.viewDocument,familiarizedBtn:!1},on:{"close-modal":function(s){return t.closeViewDocModal()}}}):t._e(),t.signingModal?e("Popup",{ref:"signingModal",on:{"close-modal":function(s){t.signingModal=!1}}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h2"},[t._v("Подписание загруженных документов")])]),e("div",{staticClass:"order-success"},[e("div",{staticClass:"order-success-submit"},[e("button",{staticClass:"btn btn-block btn-lg",class:{loading:t.load},attrs:{disabled:t.load},on:{click:t.initDiadocScript}},[t._v("Подписать ")]),e("p",[t._v("Подписание осуществляется при помощи ЭП")])])])]):t._e(),t.diadocModal?e("Popup",{ref:"diadocModal",attrs:{classes:"diadoc-plugins-modal"},on:{"close-modal":t.closeDiadocModal}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h2"},[t._v("Для подписания документов при помощи ЭЦП Вам необходимо:")])]),e("div",{staticClass:"popup-body"},[e("div",{staticClass:"plugins-list"},[e("div",{staticClass:"plugins-list-item"},[t._v("1. Установить криптопровайдер: "),e("br"),e("a",{staticClass:"link",attrs:{href:"https://www.cryptopro.ru/products/cades/plugin",target:"_blank"}},[t._v("КриптоПро CSP")])]),e("div",{staticClass:"plugins-list-item"},[t._v("2. Установите КриптоПро ЭЦП Browser plug-in: "),e("br"),e("a",{staticClass:"link",attrs:{href:"https://cryptopro.ru/products/cades/plugin/get_2_0",target:"_blank"}},[t._v("КриптоПро CSP Browser plug-in")])])])])]):t._e(),t.sertificatesModal?e("Popup",{ref:"sertificatesModal",attrs:{classes:"sertificates-modal"},on:{"close-modal":t.closeSertificatesModal}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h2"},[t._v("Выберите необходимый сертификат для цифровой подписи документов:")])]),e("div",{staticClass:"popup-body"},[e("div",{staticClass:"select-sertificates"},t._l(t.sertificates,(function(s){return e("div",{key:s._cadesCertificate.objid,staticClass:"sertificates-item",class:{active:t.selectedSertificates==s},on:{click:function(e){t.selectedSertificates=s}}},[e("span",[t._v(t._s(s.name)+" (действителен до: "+t._s(t.parseDate(s.validTo))+")")])])})),0),e("div",{staticClass:"sertificate-helper"},[e("p",[t._v(" * Если не видите необходимый сертификат, то возможно он не добавлен в программе КриптоПро. Чтобы добавить сертификат в КриптоПро следуйте следующей инструкции:"),e("br"),e("a",{staticClass:"download-link",attrs:{href:"#"},on:{click:function(s){s.preventDefault(),t.instructionPopup=!0}}},[t._v("Инструкция по добавлению сертификата")])])]),e("button",{staticClass:"btn btn-block",class:{loading:t.signLoad},attrs:{disabled:t.signLoad},on:{click:t.createSignature}},[t._v("Подписать")])])]):t._e(),t.mobModal?e("Popup",{ref:"mobModal",attrs:{classes:"mob-modal"},on:{"close-modal":function(s){t.mobModal=!1}}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h2"},[t._v("Внимание!")])]),e("div",{staticClass:"popup-body"},[e("p",[t._v("Подписание при помощи ЭЦП невозможно с мобильного устройства. Пожалуйста, перейдите на десктопную версию и установите необходимые программы:")]),e("div",{staticClass:"plugins-list"},[e("div",{staticClass:"plugins-list-item"},[t._v("1. Криптопровайдер: "),e("br"),e("a",{staticClass:"link",attrs:{href:"https://www.cryptopro.ru/products/cades/plugin",target:"_blank"}},[t._v("КриптоПро CSP")])]),e("div",{staticClass:"plugins-list-item"},[t._v("2. КриптоПро ЭЦП Browser plug-in: "),e("br"),e("a",{staticClass:"link",attrs:{href:"https://cryptopro.ru/products/cades/plugin/get_2_0",target:"_blank"}},[t._v("КриптоПро CSP Browser plug-in")])])])])]):t._e(),t.errorDiadocModal?e("Popup",{attrs:{error:!0,classes:"error-modal",zIndex:101},on:{"close-modal":function(s){t.errorDiadocModal=!1}}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h3"},[t._v("Ошибка")])]),e("div",{staticClass:"popup-body"},[e("p",{staticClass:"error-text"},[t._v(t._s(t.errorDiadocText))]),e("button",{staticClass:"btn btn-lg btn-block close-modal"},[t._v("Попробовать снова")])])]):t._e(),t.instructionPopup?e("Popup",{ref:"instructionPopup",attrs:{classes:"instruction-modal"},on:{"close-modal":function(s){t.instructionPopup=!1}}},[e("div",{staticClass:"popup-title"},[e("div",{staticClass:"h2"},[t._v("Инструкция по добавлению сертификата")])]),e("div",{staticClass:"popup-body"},[e("ol",[e("li",[t._v("Вставьте цифровой носитель электронной подписи")]),e("li",[t._v("Откройте программу КриптоПро CSP на компьютере")]),e("li",[t._v('Нажмите на вкладку "Сервис"')]),e("li",[t._v('В окне выберите пункт "Просмотреть сертификаты в контейнере"')]),e("li",[t._v('В открывшемся окне нажмите на кнопку "Обзор". Выберите контейнер и подтвердите свой выбор кнопкой ОК')]),e("li",[t._v('В открывшемся окне нажмите на кнопку "Установить". После этого согласитесь с предложением заменить сертификат')]),e("li",[t._v("Обновите страницу в браузере")])]),e("p",[t._v("С более подробной инструкцией вы можете ознакомиться по "),e("a",{staticClass:"link",attrs:{href:"https://cryptostore.ru/article/instruktsii/kak_ustanovit_sertifikat_podpisi_cherez_kriptopro_csp/",target:"_blank"}},[t._v("ссылке")])])])]):t._e()],1)},a=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"page-title"},[e("h1",[t._v("Загрузить документы")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"block-title"},[e("div",{staticClass:"h3"},[t._v("Необходимые документы")]),e("p",[t._v("Загрузите необходимые документы по списку. Допустимые форматы: JPG, DOC, PDF, XLS.")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("Загрузите необходимые документы"),e("br"),t._v("чтобы продолжить ")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"upload-documents-status"},[e("div",{staticClass:"upload-success"},[e("div",{staticClass:"upload-success-text"},[t._v("Загружено")])])])}],o=e("5530"),n=(e("159b"),e("d3b7"),e("3ca3"),e("ddb0"),e("498a"),e("ac1f"),e("5319"),e("b0c0"),e("8acc")),c=e("2f2e"),l=e("2f62"),d=e("fb07"),r=e("c1df"),u=e.n(r),p={name:"load-documents",components:{DocView:c["a"],Popup:n["a"]},computed:Object(o["a"])(Object(o["a"])({},Object(l["c"])({company:function(t){return t.users.company},orderFullInfo:function(t){return t.createOrder.orderFullInfo},neededToLoadFiles:function(t){return t.createOrder.neededToLoadFiles},documentsForSigning:function(t){return t.createOrder.documentsForSigning}})),{},{canSignature:function(){var t=!0;return this.neededToLoadFiles.forEach((function(s){0===s.files.length&&(t=!1)})),t}}),data:function(){return{load:!1,orderUpdatedModal:!1,checkLoadedDocs:!1,loadedDocsViews:[],selectBranch:!1,signingModal:!1,diadocModal:!1,errorDiadocModal:!1,errorDiadocText:"",sertificatesModal:!1,mobModal:!1,signLoad:!1,sertificates:[],selectedSertificates:{},viewDocumentModal:!1,viewDocument:{},instructionPopup:!1}},methods:{selectedFile:function(t,s){s.loaded=!0,this.$store.dispatch("sendFile",{files:t.target.files,id:s.id}).then((function(){s.loaded=!1}))},signingEvent:function(){var t=this;this.load=!0,setTimeout((function(){t.load=!1,t.$refs.signingModal.closePopup(),t.orderUpdatedModal=!0}),1e3)},doneLoadFiles:function(){this.canSignature&&(this.signingModal=!0)},closeSigningModal:function(){this.signingModal=!1},closeUpdatedModal:function(){this.orderUpdatedModal=!0,this.$router.push("/orders")},closeViewDocModal:function(){this.viewDocumentModal=!1},openDocViewModal:function(t){"pdf"===t.format||"jpg"===t.format||"png"===t.format?(this.viewDocument=t,this.viewDocumentModal=!0):this.docViewErrorModal=!0},deleteFiles:function(t){var s=this;this.$store.dispatch("deleteFiles",t).then((function(){s.$store.dispatch("getNeededToLoadFiles",s.$route.params.id)}))},initDiadocScript:function(){var t=this;this.load||(this.load=!0,Object(d["getSystemInfo"])().then((function(s){t.load=!1,Object(d["getUserCertificates"])().then((function(s){if(s.length>0){var e=[];t.sertificates=[],s.forEach((function(s){e.push(new Promise((function(e){s.isValid().then((function(){t.sertificates.push(s),e()}))})))})),Promise.all(e).then((function(){t.load=!1,t.$refs.signingModal.closePopup(),t.selectedSertificates=t.sertificates[0],t.sertificatesModal=!0}))}})).catch((function(s){switch(s){case"certificates_not_found":t.errorDiadocText="Не найдено ни одного сертификата.";break;case"valid_certificates_not_found":t.errorDiadocText="Не найдено ни одного валидного сертификата.";break;case"certificate_read_error":t.errorDiadocText="Ошибка чтения одного из сертификатов.";break}t.errorDiadocModal=!0}))})).catch((function(s){t.load=!1,t.diadocModal=!0,t.$refs.signingModal.closePopup()})))},readFile:function(t){return new Promise((function(s){var e=new FileReader;e.onload=function(){s(this.result)},e.readAsArrayBuffer(t)}))},generateSignature:function(t){var s,e=this.selectedSertificates;return new Promise((function(i,a){s=Object(d["createAttachedSignature"])(e.thumbprint,t),s.then((function(t){i(t)}),(function(t){this.errorDiadocText=t.message,this.errorDiadocModal=!0,a()}))}))},createSignature:function(){var t=this,s=this.selectedSertificates.name.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"").toLowerCase().trim(),e=this.company.name.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"").toLowerCase().trim();if(s!==e)return this.errorDiadocText="Вы выбрали сертификат, который не принадлежит компании",this.errorDiadocModal=!0,!1;this.signLoad=!0;var i=this,a=[],o=[];this.neededToLoadFiles.forEach((function(s,e){0!==s.files.length&&(o.push({id:s.id,docs:[]}),s.files.forEach((function(s){a.push(new Promise((function(a,n){t.$store.dispatch("getFile",s.id).then((function(c){var l=new File([c],s.name,{type:s.format}),r=t.readFile(l);r.then((function(t){Object(d["createHash"])(t).then((function(){i.generateSignature(t).then((function(t){o[e].docs.push({id:s.id,signature:t}),a()}))}),(function(t){this.errorDiadocText=t.message,this.errorDiadocModal=!0,n()}))}))}))})))})))})),Promise.all(a).then((function(){var s=[];o.forEach((function(e){s.push(new Promise((function(s){t.$store.dispatch("sendSignature",e).then((function(t){t&&s()}))})))})),Promise.all(s).then((function(){t.$store.dispatch("sendAdditionalDocs",t.$route.params.id).then((function(s){s?(t.signLoad=!1,t.$refs.sertificatesModal.closePopup(),t.successModal=!0,t.$router.push("/orders")):t.signLoad=!1}))})).catch((function(){return t.signLoad=!1}))}))},closeSuccessModal:function(){this.successModal=!1,this.$router.push("/orders")},closeDiadocModal:function(){this.diadocModal=!1},closeSertificatesModal:function(){this.sertificatesModal=!1},parseDate:function(t){return u()(t).format("DD.MM.YYYY")},loadDocument:function(t){var s=this;this.$store.dispatch("getFile",t.id).then((function(e){s.$store.dispatch("downloadFile",{content:e,name:t.name,format:t.format})}))}},mounted:function(){this.$store.dispatch("getCurrentOrder",this.$route.params.id),this.$store.dispatch("getNeededToLoadFiles",this.$route.params.id),this.$store.dispatch("getDocumentsForSigning",this.$route.params.id)}},f=p,v=e("2877"),h=Object(v["a"])(f,i,a,!1,null,"5b9f9ec5",null);s["default"]=h.exports}}]);
//# sourceMappingURL=chunk-2d2101f2.c67eb60c.js.map